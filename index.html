<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kheil Pro Ultimate | Ù…Ù†ØµØ© Ø§Ù„Ù‚Ù†Ø§Øµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        :root {
            --primary: #0f172a;
            --accent: #10b981;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f1f5f9;
            color: #334155;
            overflow-x: hidden;
        }

        /* ØªØ­Ø³ÙŠÙ† Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .kheil-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        .kheil-table tr {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .kheil-table tr:hover {
            transform: scale(1.01);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.1);
            border-right: 4px solid var(--accent);
        }
        .kheil-table td {
            padding: 16px;
            vertical-align: middle;
        }
        .kheil-table td:first-child { border-radius: 0 8px 8px 0; }
        .kheil-table td:last-child { border-radius: 8px 0 0 8px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ù‚ÙŠÙ‚ */
        .score-bar-bg {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            width: 100px;
        }
        .score-bar-fill { height: 100%; border-radius: 3px; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .btn-tool {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: bold;
            transition: all 0.2s;
            text-decoration: none;
            border: 1px solid transparent;
        }
        .btn-atom { background: #eef2ff; color: #4f46e5; border-color: #c7d2fe; }
        .btn-atom:hover { background: #4f46e5; color: white; }
        
        .btn-godaddy { background: #ecfdf5; color: #047857; border-color: #6ee7b7; }
        .btn-godaddy:hover { background: #047857; color: white; }

        .btn-archive { background: #f8fafc; color: #475569; border-color: #cbd5e1; }
        .btn-archive:hover { background: #475569; color: white; }

        /* Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± */
        canvas { display: none; } /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© */

        .step-active { border-color: #10b981; color: #10b981; background: #ecfdf5; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-slate-900 text-white py-4 px-6 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-crosshairs text-green-400 text-2xl"></i>
                <div>
                    <h1 class="text-xl font-black tracking-wide">KHEIL PRO <span class="text-green-400">ULTIMATE</span></h1>
                    <p class="text-[10px] text-slate-400">Ù†Ø¸Ø§Ù… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                </div>
            </div>
            <div class="flex gap-4 text-sm font-bold">
                <div id="step-1-ind" class="flex items-center gap-2 px-3 py-1 rounded-full border border-green-500 text-green-400 bg-green-900/20">
                    <span>1</span> Ø±ÙØ¹
                </div>
                <div id="step-2-ind" class="flex items-center gap-2 px-3 py-1 rounded-full border border-slate-700 text-slate-500">
                    <span>2</span> Ù…Ø±Ø§Ø¬Ø¹Ø©
                </div>
                <div id="step-3-ind" class="flex items-center gap-2 px-3 py-1 rounded-full border border-slate-700 text-slate-500">
                    <span>3</span> ØªØ­Ù„ÙŠÙ„
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-6xl">

        <section id="view-upload" class="bg-white rounded-2xl shadow-xl p-10 text-center transition-all">
            <h2 class="text-2xl font-bold text-slate-800 mb-2">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª Ù…Ù† Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©</h2>
            <p class="text-slate-500 mb-8">ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© OCR Ù…ØªÙ‚Ø¯Ù…Ø© Ù…Ø¹ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¯Ù‚Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©.</p>
            
            <div class="border-4 border-dashed border-slate-200 rounded-3xl p-12 cursor-pointer hover:border-green-400 hover:bg-green-50 transition group relative overflow-hidden" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" class="hidden" accept="image/*">
                
                <div id="upload-placeholder">
                    <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition">
                        <i class="fa-solid fa-image text-3xl text-slate-400 group-hover:text-green-500"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-700">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§</h3>
                    <p class="text-sm text-slate-400">ÙŠØ¯Ø¹Ù… JPG, PNG (Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©)</p>
                </div>

                <div id="processing-ui" class="hidden absolute inset-0 bg-white flex flex-col items-center justify-center z-10">
                    <div class="w-16 h-16 border-4 border-slate-200 border-t-green-500 rounded-full animate-spin mb-4"></div>
                    <h3 class="font-bold text-slate-800 animate-pulse" id="status-text">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©...</h3>
                    <p class="text-xs text-slate-400 mt-2">ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø£Ø¨ÙŠØ¶ ÙˆØ§Ù„Ø£Ø³ÙˆØ¯ + Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ¨Ø§ÙŠÙ†</p>
                </div>
            </div>
            
            <canvas id="processCanvas"></canvas>
        </section>

        <section id="view-review" class="hidden bg-white rounded-2xl shadow-xl p-8">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-slate-800">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©</h2>
                    <p class="text-sm text-slate-500">Ù‚Ù… Ø¨Ø­Ø°Ù Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p>
                </div>
                <button onclick="runFinalAnalysis()" class="bg-slate-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-600 transition shadow-lg">
                    Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„ ğŸš€
                </button>
            </div>

            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 max-h-[500px] overflow-y-auto">
                <div id="review-list" class="flex flex-wrap gap-2">
                    </div>
            </div>
        </section>

        <section id="view-dashboard" class="hidden space-y-6">
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-slate-800">
                    <div class="text-slate-500 text-xs font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª</div>
                    <div class="text-2xl font-black text-slate-800" id="stat-total">0</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-green-500">
                    <div class="text-slate-500 text-xs font-bold">ÙØ±Øµ Ø°Ù‡Ø¨ÙŠØ© (Elite)</div>
                    <div class="text-2xl font-black text-green-600" id="stat-elite">0</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-blue-500">
                    <div class="text-slate-500 text-xs font-bold">Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Atom</div>
                    <div class="text-2xl font-black text-blue-600" id="stat-atom">0</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-red-500">
                    <div class="text-slate-500 text-xs font-bold">Ù…Ø±ÙÙˆØ¶Ø© (Junk)</div>
                    <div class="text-2xl font-black text-red-600" id="stat-junk">0</div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                    <h3 class="font-bold text-lg text-slate-800">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ (Kheil Protocol)</h3>
                    <button onclick="location.reload()" class="text-sm text-slate-400 hover:text-red-500">
                        <i class="fa-solid fa-rotate-right"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡
                    </button>
                </div>
                
                <div class="overflow-x-auto p-4">
                    <table class="kheil-table">
                        <thead>
                            <tr class="text-right text-xs text-slate-400 uppercase bg-transparent shadow-none hover:shadow-none hover:transform-none">
                                <th class="pb-3 pr-4">Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†</th>
                                <th class="pb-3">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</th>
                                <th class="pb-3">Ø§Ù„Ù†Ù‚Ø§Ø· (Score)</th>
                                <th class="pb-3">Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</th>
                            </tr>
                        </thead>
                        <tbody id="results-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Configuration & Logic ---
        const CONFIG = {
            validTLDs: ['com', 'ai', 'io', 'net', 'co', 'org', 'app', 'xyz'],
            badKeywords: ['cheap', 'free', 'buy', 'porn', 'sex', 'hack', 'crack', 'spam', 'junk', '123', 'best', 'shop', 'store'],
            trendKeywords: ['ai', 'gpt', 'tech', 'data', 'flow', 'soft', 'meta', 'chain', 'bot', 'lab', 'sys', 'agent', 'link', 'cloud', 'brain', 'mind'],
        };

        let rawTextData = [];
        let cleanDomains = [];

        // --- 1. IMAGE PROCESSING ENGINE ---
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            if (!e.target.files[0]) return;
            const file = e.target.files[0];
            
            // UI Switch
            document.getElementById('upload-placeholder').classList.add('hidden');
            document.getElementById('processing-ui').classList.remove('hidden');

            try {
                // Step A: Pre-process Image (The Secret Sauce)
                document.getElementById('status-text').innerText = "ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ±Ø©...";
                const processedImage = await processImageForOCR(file);

                // Step B: Run OCR
                document.getElementById('status-text').innerText = "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ (OCR)...";
                const worker = await Tesseract.createWorker('eng');
                const { data: { text } } = await worker.recognize(processedImage);
                await worker.terminate();

                // Step C: Initial Filtering
                document.getElementById('status-text').innerText = "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
                parseExtractedText(text);

            } catch (err) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
                location.reload();
            }
        });

        function processImageForOCR(file) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = URL.createObjectURL(file);
                img.onload = () => {
                    const canvas = document.getElementById('processCanvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Resize to larger if too small (helps OCR)
                    const scale = img.width < 1000 ? 2 : 1;
                    canvas.width = img.width * scale;
                    canvas.height = img.height * scale;
                    
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    // Image Manipulation: Grayscale + Contrast
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    for (let i = 0; i < data.length; i += 4) {
                        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        // Binarization (Black & White only) - Threshold 128
                        const color = avg > 140 ? 255 : 0; 
                        data[i] = color;
                        data[i + 1] = color;
                        data[i + 2] = color;
                    }
                    ctx.putImageData(imageData, 0, 0);
                    resolve(canvas.toDataURL('image/jpeg'));
                };
            });
        }

        function parseExtractedText(text) {
            // Regex: Looks for word.extension (strict)
            const regex = /[a-zA-Z0-9-]+\.(com|ai|io|net|co|org|app|xyz)/gi;
            const matches = text.match(regex) || [];
            
            // Deduplicate
            rawTextData = [...new Set(matches.map(d => d.toLowerCase()))];
            
            if (rawTextData.length === 0) {
                alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª ÙˆØ§Ø¶Ø­Ø©. Ø­Ø§ÙˆÙ„ Ø¨ØµÙˆØ±Ø© Ø£ÙˆØ¶Ø­.");
                location.reload();
                return;
            }

            renderReviewList();
            
            // Switch View
            document.getElementById('view-upload').classList.add('hidden');
            document.getElementById('view-review').classList.remove('hidden');
            updateSteps(2);
        }

        // --- 2. REVIEW & FILTERING ---
        function renderReviewList() {
            const container = document.getElementById('review-list');
            container.innerHTML = '';
            
            rawTextData.forEach((domain, index) => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-2 bg-white border border-slate-200 px-3 py-2 rounded-lg shadow-sm cursor-pointer hover:border-red-400 transition group";
                div.innerHTML = `
                    <span class="font-mono text-slate-700">${domain}</span>
                    <i class="fa-solid fa-trash text-slate-300 group-hover:text-red-500"></i>
                `;
                div.onclick = () => {
                    rawTextData.splice(index, 1); // Remove from array
                    div.remove(); // Remove from UI
                };
                container.appendChild(div);
            });
        }

        function runFinalAnalysis() {
            cleanDomains = rawTextData.map(d => analyzeDomainLogic(d));
            cleanDomains.sort((a,b) => b.totalScore - a.totalScore);
            
            renderDashboard();
            
            document.getElementById('view-review').classList.add('hidden');
            document.getElementById('view-dashboard').classList.remove('hidden');
            updateSteps(3);
        }

        // --- 3. KHEIL PRO 3.0 LOGIC ---
        function analyzeDomainLogic(domain) {
            const parts = domain.split('.');
            const name = parts[0];
            const ext = parts[1];
            
            let stats = {
                domain: domain,
                forensic: 100,
                sniper: 0,
                expert: 50,
                totalScore: 0,
                messages: [],
                isElite: false,
                isAtom: false,
                isJunk: false
            };

            // 1. Forensic (Safety)
            if (/\d/.test(name)) { stats.forensic -= 50; stats.messages.push("ÙŠØ­ØªÙˆÙŠ Ø£Ø±Ù‚Ø§Ù…"); }
            if (name.includes('-')) { stats.forensic -= 50; stats.messages.push("ÙŠØ­ØªÙˆÙŠ Ù‡Ø§ÙŠÙÙ† (-)"); }
            CONFIG.badKeywords.forEach(w => {
                if (name.includes(w)) { stats.forensic -= 40; stats.messages.push(`ÙƒÙ„Ù…Ø© Ø±Ø®ÙŠØµØ©: ${w}`); }
            });
            if (stats.forensic < 50) stats.isJunk = true;

            // 2. Sniper (Value)
            if (ext === 'ai') stats.sniper += 40;
            else if (ext === 'com') stats.sniper += 30;
            else stats.sniper += 10;
            
            CONFIG.trendKeywords.forEach(t => {
                if (name.includes(t)) { stats.sniper += 20; stats.messages.push(`Trend: ${t}`); }
            });
            
            if (name.length <= 4) stats.sniper += 30;

            // 3. Expert (Brandability/Atom)
            const vowels = (name.match(/[aeiouy]/g) || []).length;
            if (vowels === 0) stats.expert -= 30;
            
            // Atom Logic: Short + Pronounceable
            if (name.length <= 8 && vowels > 0 && !stats.isJunk) {
                stats.expert += 20;
                stats.isAtom = true;
            }

            // Calc Total
            stats.forensic = Math.max(0, stats.forensic);
            stats.sniper = Math.min(100, stats.sniper);
            stats.expert = Math.min(100, stats.expert);
            stats.totalScore = Math.floor((stats.forensic * 0.3) + (stats.sniper * 0.4) + (stats.expert * 0.3));

            if (stats.totalScore >= 75) stats.isElite = true;

            return stats;
        }

        // --- 4. RENDER DASHBOARD ---
        function renderDashboard() {
            // Update Top Stats
            document.getElementById('stat-total').innerText = cleanDomains.length;
            document.getElementById('stat-elite').innerText = cleanDomains.filter(d => d.isElite).length;
            document.getElementById('stat-atom').innerText = cleanDomains.filter(d => d.isAtom).length;
            document.getElementById('stat-junk').innerText = cleanDomains.filter(d => d.isJunk).length;

            const tbody = document.getElementById('results-body');
            tbody.innerHTML = '';

            cleanDomains.forEach(d => {
                const tr = document.createElement('tr');
                
                // Color for score
                let scoreColor = d.totalScore >= 75 ? 'text-green-600' : (d.totalScore >= 50 ? 'text-yellow-600' : 'text-red-600');
                
                tr.innerHTML = `
                    <td>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center bg-slate-100 text-slate-500 font-bold text-xs border">
                                .${d.domain.split('.')[1]}
                            </div>
                            <div>
                                <div class="font-bold text-slate-800 text-lg">${d.domain}</div>
                                <div class="text-[10px] text-slate-400 flex gap-1">
                                    ${d.messages.slice(0, 2).map(m => `<span class="bg-slate-100 px-1 rounded">${m}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="space-y-1">
                            <div class="flex items-center gap-2 text-xs">
                                <span class="w-16 text-slate-400">Forensic</span>
                                <div class="score-bar-bg"><div class="score-bar-fill bg-blue-500" style="width: ${d.forensic}%"></div></div>
                            </div>
                            <div class="flex items-center gap-2 text-xs">
                                <span class="w-16 text-slate-400">Sniper</span>
                                <div class="score-bar-bg"><div class="score-bar-fill bg-purple-500" style="width: ${d.sniper}%"></div></div>
                            </div>
                            <div class="flex items-center gap-2 text-xs">
                                <span class="w-16 text-slate-400">Expert</span>
                                <div class="score-bar-bg"><div class="score-bar-fill bg-green-500" style="width: ${d.expert}%"></div></div>
                            </div>
                        </div>
                    </td>
                    <td class="text-center">
                        <div class="text-3xl font-black ${scoreColor}">${d.totalScore}</div>
                        ${d.isElite ? '<div class="text-[10px] font-bold text-green-600 uppercase tracking-widest">Elite</div>' : ''}
                    </td>
                    <td>
                        <div class="flex flex-col gap-2">
                            <a href="https://www.godaddy.com/domain-value-appraisal/appraisal/?domainToCheck=${d.domain}" target="_blank" class="btn-tool btn-godaddy">
                                <i class="fa-solid fa-tag"></i> GoDaddy Value
                            </a>
                            <a href="https://www.atom.com/name-search?q=${d.domain.split('.')[0]}" target="_blank" class="btn-tool btn-atom">
                                <i class="fa-solid fa-atom"></i> Atom Check
                            </a>
                            <a href="https://web.archive.org/web/*/${d.domain}" target="_blank" class="btn-tool btn-archive">
                                <i class="fa-solid fa-clock-rotate-left"></i> Archive
                            </a>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateSteps(step) {
            for(let i=1; i<=3; i++) {
                const el = document.getElementById(`step-${i}-ind`);
                if(i === step) {
                    el.className = "flex items-center gap-2 px-3 py-1 rounded-full border border-green-500 text-green-400 bg-green-900/20";
                } else if (i < step) {
                    el.className = "flex items-center gap-2 px-3 py-1 rounded-full border border-green-500 text-white bg-green-500";
                    el.innerHTML = `<span><i class="fa-solid fa-check"></i></span>`;
                } else {
                    el.className = "flex items-center gap-2 px-3 py-1 rounded-full border border-slate-700 text-slate-500";
                }
            }
        }
    </script>
</body>
</html>
